#!/bin/bash

if [ `hostname | cut -c 1-4` == "ewok" ]; then

    ########
    # Ewok #
    ########
    echo "Configure on EWOK"
    export CC=mpicc
    #export FC=mpif90
    source /etc/profile.d/modules.sh
    module unload hdf5
    module unload netcdf
    module unload PE-gnu
    module unload PE-pgi
    module unload PE-pathscale
    module unload pgi
    TARGET=gnu
    module load PE-$TARGET
    module load hdf5/1.8.2_par
    module load netcdf
    export CFLAGS="-g -fPIC" 
    ./configure --prefix=/ccs/home/ge1/work/ewok \
        --enable-dependency-tracking \
        --with-mxml=/ccs/proj/e2e/pnorbert/mxml \
        --enable-research-transports  \
        --with-phdf5=$HDF5_DIR \
        --without-netcdf
        #--with-hdf5=$HDF5_DIR  \
        #--with-netcdf=/apps/netcdf/3.6.1/ewok_x86_64_pgi625
        #--with-dart=/ccs/proj/e2e/dart
        #--with-dmalloc=/ccs/proj/e2e/pnorbert/dmalloc.$TARGET 
        #--enable-shared --disable-static\
        #--enable-datatap=ib


elif [ `hostname | cut -c 1-6` == "jaguar" ]; then

    ##########
    # Jaguar #
    ##########
    echo "Configure on JAGUAR"
    export CC=cc
    #export CFLAGS="-Wall -g" 
    export FC=ftn
    source /opt/modules/default/etc/modules.sh
    module unload szip
    module unload hdf5
    module unload netcdf
    module unload PrgEnv-gnu
    module unload PrgEnv-pgi
    module unload PrgEnv-intel
    module unload PrgEnv-cray
    module unload xt-papi
    #module unload xtpe-quadcore
    TARGET=pgi
    module load PrgEnv-$TARGET
    module load netcdf-hdf5parallel
    module load szip
    module load xt-papi
    module load hdf5-parallel
    ## the netcdf-hdf5parallel module only sets NETCDF_PARALLEL_VERSION.
    ## /opt/cray/xt-asyncpe/3.2/bin/linux-f90 only checks NETCDF_VERSION.
    ## set NETCDF_VERSION here so that configure can complete.
    export NETCDF_VERSION=$NETCDF_PARALLEL_VERSION
    # use the two lines below for openmpi
    #export CC=mpicc
    #export FC=mpif90
    CFLAGS="-fPIC" ./configure --prefix=/ccs/home/ge1/work/jaguar \
        --enable-dependency-tracking \
        --with-hdf5-libdir="/ -lsz -lz" \
        --with-mxml=/ccs/proj/e2e/pnorbert/mxml.xt5.$TARGET \
        --enable-research-transports
        #--with-dart=/ccs/proj/e2e/dart
        #--with-hdf5=/sw/xt5/hdf5/1.6.7/cnl2.1_pgi7.2.3_par \
        #--with-netcdf=/sw/xt5/netcdf/3.6.2/sles9.2_pgi7.0.7
        #--with-hdf5-libdir="/sw/xt5/hdf5/1.6.7/cnl2.1_pgi7.2.3_par/lib -L/sw/xt5/szip/2.1/sles9.2_pgi7.0.7/lib -lsz -lz" 
    
elif [ `hostname | cut -c 1-4` == "euge" ]; then
    ###################
    # Eugene BlueGene #
    ###################
    export MPICC=mpixlc_r
    export MPIFC=mpixlf90
    export CFLAGS="-g -O0"
    #export FCFLAGS="-qextname"
    export FC=xlf90
    export CC=xlc_r

    source /etc/profile.d/modules.sh
    module load netcdf/3.6.2-linux
    module load hdf5/1.8.1-linux

    ./configure --prefix=/ccs/proj/e2e/pnorbert/ADIOS/eugene \
            --enable-dependency-tracking \
            --with-mxml=/ccs/proj/e2e/adios/bgp  
        #--with-hdf5=/sw/bgp/hdf5/1.8.0/sles10.1_xlc9.0xlf11.1 \
        #--with-hdf5-libdir="/sw/bgp/hdf5/1.8.0/sles10.1_xlc9.0xlf11.1/lib -lhdf5 -L/sw/bgp/szip/2.1/sles10.1_xlc9.0/lib -lsz /usr/lib/libz.a" \
        #--with-netcdf=/sw/bgp/netcdf/3.6.2/sles10.1_xlc9.0xlf11.1

elif [ `hostname | cut -c 1-4` == "lens" ]; then

    ########
    # Lens #
    ########
    echo "Configure on LENS"
    export CC=mpicc
    source /etc/profile.d/modules.sh
    module load hdf5
    module load netcdf
    CFLAGS="-fPIC" ./configure --prefix=/ccs/proj/e2e/pnorbert/adios/lens \
        --enable-dependency-tracking \
        --with-mxml=/ccs/proj/e2e/pnorbert/mxml
        #--with-hdf5=/sw/analysis-x64/hdf5/1.6.7/sl5.0_pgi7.1.5_ompi1.2.6 \
        #--with-netcdf=/sw/analysis-x64/netcdf/3.6.2/sl5.0_pgi7.1.5
    
    
elif [ `hostname | cut -c 1-4` == "nid0" ]; then
    ############
    # Franklin #
    ############
    echo "Configure on FRANKLIN"
    export CC=cc
    export FC=ftn
    module unload hdf5
    module unload netcdf
    module load netcdf/3.6.2
    module load hdf5_par/1.6.5
    CFLAGS="-fPIC" ./configure --prefix=/project/projectdirs/m499/adios \
        --enable-dependency-tracking \
        --with-mxml=$HOME/mxml 
        #--with-phdf5=/usr/common/usg/hdf5/1.6.5/parallel/lib \
        #--with-phdf5-libdir="/usr/common/usg/hdf5/1.6.5/parallel/lib -lhdf5_fortran -lhdf5_hl -lhdf5 -L/usr/common/usg/zlib/default/lib -lz -L/usr/common/usg/szip/default/lib -lsz -I/usr/common/usg/hdf5/1.6.5/parallel/include -I/usr/common/usg/zlib/default/include -I/usr/common/usg/szip/default/include" \
        #--with-netcdf=/usr/common/usg/netcdf/3.6.2
    
    
elif [ `hostname | cut -c 1-4` == "dyn9" -o `hostname | cut -c 1-10` == "podhorszki" ]; then

    #######
    # Mac #
    #######
    #
    # NOTE: disable-write is required to build on Mac
    #
    echo "Configure on Mac"
    export CC=mpicc
    export FC=mpif90
    CFLAGS="-DO_LARGEFILE=0 -fno-common" ./configure --prefix=/opt/adios \
        --with-mxml=/opt/mxml \
        --with-netcdf=/opt/netcdf \
        --with-hdf5=/opt/hdf5 \
        --disable-write
        #--enable-dependency-tracking --enable-shared --disable-static

elif [ `hostname | cut -c 1-7` == "ubuntu" ]; then

    #########################
    # Scott's ubuntu laptop #
    #########################
    echo "Configure on UBUNTU"
    export CC=mpicc
    ./configure --prefix=/usr/local/adios \
        --enable-dependency-tracking \
        --with-mxml=/usr/local/adios 
        #--with-hdf5=/usr/local/hdf5-serial\
        #--with-phdf5=/usr/local \
        #--with-netcdf=/usr 

elif [ `hostname | cut -c 1-6` == "tomato" ]; then

    #########################
    # Todd's ubuntu laptop #
    #########################
    echo "Configure on UBUNTU"
    export CC=mpicc
    ./configure --prefix=/home/thkorde/local \
        --enable-dependency-tracking \
        --with-mxml=/home/thkorde/local \
        --with-phdf5=/home/thkorde/local \
        --with-hdf5=/home/thkorde/local \
        --with-netcdf=/home/thkorde/local

else
    echo "Could not determine what machine is this"
    echo "This script is just for configuring adios on the authors' machines"
    echo "You can study it to figure out how to configure adios on your system"
fi
    
    
    
